pre-commit:
  parallel: true
  commands:
    prettier:
      glob: '*.{js,mjs,ts,vue,json,md,yml,yaml,css,scss,html}'
      run: pnpm format:check:staged {staged_files}
      fail_text: '❌ Code formatting issues found. Run "pnpm format" to fix them and commit again.'

    forbidden-branches:
      run: |
        BRANCH=$(git rev-parse --abbrev-ref HEAD)
        if [ "$BRANCH" = "main" ] || [ "$BRANCH" = "master" ]; then
          echo "❌ Direct commits to $BRANCH branch are forbidden!"
          exit 1
        fi

commit-msg:
  commands:
    commitlint:
      run: pnpm commitlint --edit {1}
      skip:
        - merge
        - rebase

pre-push:
  commands:
    forbidden-branches:
      run: |
        BRANCH=$(git rev-parse --abbrev-ref HEAD)
        if [ "$BRANCH" = "main" ] || [ "$BRANCH" = "master" ]; then
          echo "❌ Pushing to $BRANCH branch is forbidden!"
          exit 1
        fi

    eslint:
      glob: '*.{js,mjs,ts,vue}'
      run: pnpm lint:staged {staged_files}
      fail_text: '❌ ESLint found issues. Run "pnpm lint:fix" to fix them and push again.'

    typecheck:
      run: pnpm typecheck
      fail_text: '❌ TypeScript type checking failed. Please fix type errors and try again.'

post-checkout:
  commands:
    pnpm-install:
      files: git diff --name-only HEAD@{1} HEAD
      glob: '{package.json,pnpm-lock.yaml}'
      run: |
        pnpm install
        echo "⚠️  Dependencies changed - you may need to restart your dev server"

post-merge:
  commands:
    pnpm-install:
      files: git diff --name-only HEAD@{1} HEAD
      glob: '{package.json,pnpm-lock.yaml}'
      run: |
        pnpm install
        echo "⚠️  Dependencies changed - you may need to restart your dev server"

skip_output:
  - meta
  - success

colors: true
